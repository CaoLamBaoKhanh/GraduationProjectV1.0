@model ProductDetailViewModel
@{
    int score5 = 0;
    int score4 = 0;
    int score3 = 0;
    int score2 = 0;
    int score1 = 0;
    bool flag = true;
}
@section FacebookComments{
    <div id="fb-root"></div>
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v11.0&appId=846669762547678&autoLogAppEvents=1" nonce="xvuFE9SJ"></script>
}
@section Script{
    <script src="~/js/ProductRatingScoreBoard.js"></script>
    <script src="~/js/OrderCancelReason.js"></script>
}
@if (Model == null)
{
    <div class="span9">
        <h3>Sản phẩm không tồn tại hoặc đã bị xóa !</h3>
    </div>
}
else
{
    var info = System.Globalization.CultureInfo.GetCultureInfo("vi-VN");
    ViewData["Title"] = Model.Product.meta_tittle;
    ViewData["Description"] = Model.Product.meta_descriptions;
    ViewData["Keywords"] = Model.Product.meta_keywords;

    <div class="span9">
        <ul class="breadcrumb">
            <li><a href="@Url.Action("Index", "Home", new { area = "" })">Trang chủ</a> <span class="divider">/</span></li>
            <li><a href="@Url.Action("Category", "Product", new { slug = Model.Product.cate_slug })">@Model.Product.cate_name</a> <span class="divider">/</span></li>
            <li class="active">@Model.Product.name</li>
        </ul>
        <div class="row">
            <div id="gallery" class="span3">
                @{
                    if (Model.ImageList.Count > 0)
                    {
                        <a href="data:image/jpeg;base64,@Model.ImageList[0].FileAsBase64" title="@Model.Product.name">
                            <img src="data:image/jpeg;base64,@Model.ImageList[0].FileAsBase64" style="width:100%" alt="@Model.Product.name" />
                        </a>
                    }
                    else
                    {
                        <img src="none" style="width:100%" alt="Không có hình ảnh" />
                    }
                }
                @{
                    if (Model.ImageList.Count > 1)
                    {
                        <div id="differentview" class="moreOptopm carousel slide">
                            <div class="carousel-inner">
                                @{
                                    <div class="item active">
                                        @{
                                            for (int i = 1; i < Model.ImageList.Count; i++)
                                            {
                                                <a href="data:image/jpeg;base64,@Model.ImageList[i].FileAsBase64" title="@Model.Product.name"> <img style="width:29%" src="data:image/jpeg;base64,@Model.ImageList[i].FileAsBase64" alt="" /></a>

                                            }
                                        }

                                    </div>
                                }
                            </div>
                        </div>
                    }
                }
            </div>
            <div class="span6">
                <h3>@Model.Product.name</h3>
                <div class="product-code">
                    <div class="css-5nimvs">
                        Thương hiệu: <span class="css-1meclnb">@Model.Product.brand_name</span> | Mã SP: @Model.Product.code
                    </div>
                </div><br />
                <div class="product-short-desc">
                    @Html.Raw(Model.Product.short_desc)
                </div><br />
                @if (Model.Product.promotion_price > 1)
                {
                    var a = Model.Product.unit_price - Model.Product.promotion_price;
                    <span class="product-price">@String.Format(info, "{0:c}", Model.Product.promotion_price)&nbsp;&nbsp;</span>
                    <span class="product-promotion-pirce">@String.Format(info, "{0:c}", Model.Product.unit_price)&nbsp;&nbsp;</span>
                    <span class="product-total-price">Tiết kiệm @String.Format(info, "{0:c}", a)</span>
                }
                else if (Model.Product.unit_price == 0)
                {
                    <div class="btnGroup">
                        <button type="button" class="btn btn-large btn-primary">Liên hệ<i class=" icon-shopping-cart"></i></button>
                    </div>
                }
                else
                {
                    <span class="product-price">@String.Format(info, "{0:c}", Model.Product.unit_price)</span>
                }
                <br />
                <a class="btn btn-small pull-right" href="#specifications">Xem chi tiết</a><br />
                <hr class="soft" />
                <form class="form-horizontal qtyFrm">
                    <div class="control-group">
                        <div>
                            @{
                                if (Model.Product.instock > 1)
                                {
                                    <h5>
                                        Còn lại: @Model.Product.instock <small>sản phẩm</small>
                                    </h5><br />
                                    <div class="btnGroup">
                                        <button type="button" class="btn btn-large btn-primary btn-add-cart" data-id="@Model.Product.id"> Thêm vào <i class=" icon-shopping-cart"></i></button>
                                        <button type="button" class="btn btn-large btn-danger btn-buy-now" data-id="@Model.Product.id"> Mua ngay</button>
                                    </div>
                                }
                                else if (Model.Product.instock == null)
                                {
                                    <div class="btnGroup">
                                        <button type="button" class="btn btn-large btn-primary btn-add-cart" data-id="@Model.Product.id"> Thêm vào <i class=" icon-shopping-cart"></i></button>
                                        <button type="button" class="btn btn-large btn-danger btn-buy-now" data-id="@Model.Product.id"> Mua ngay</button>
                                    </div>
                                }
                                else
                                {
                                    <h5 class="OutOfStock pull-left">
                                        Hết hàng
                                    </h5>
                                }
                            }
                        </div>
                    </div>
                </form>
            </div>
            <div class="span9">
                <a href="#" name="detail"></a>
                <hr class="soft" />
                <ul id="productDetail" class="nav nav-tabs">
                    <li class="active"><a href="#specifications" data-toggle="tab">Thông số kỹ thuật</a></li>
                    <li><a href="#descriptions" data-toggle="tab">Chi tiết sản phẩm</a></li>
                    <li><a href="#rating" data-toggle="tab">Đánh giá sản phẩm</a></li>
                </ul>
                <div id="myTabContent2" class="tab-content">
                    <div class="tab-pane fade active in Detail-Product" id="specifications">
                        @Html.Raw(Model.Product.specifications)
                    </div>
                    <div class="tab-pane fade" id="descriptions">
                        @Html.Raw(Model.Product.descriptions)
                    </div>
                    <div class="tab-pane fade" id="rating">

                        @if (Model.Ratings.Count == 0)
                        {
                            <p class="receive-title">Sản phẩm này chưa có đánh giá nào</p>
                        }
                        else
                        {
                            foreach (var item in Model.Ratings)
                            {
                                <div class="review" itemscope itemtype="http://schema.org/Review">
                                    <h4 class="subheading" itemprop="itemReviewed">@item.content</h4>
                                    <p class="author" itemprop="author"><small>bởi:</small> @item.cus_name</p>
                                    <div class="rating rating--read-only">
                                        @if (item.score == 1)
                                        {
                                            score1++;
                                            <div aria-hidden="true">
                                                <span class="star star--full"></span>
                                                <span class="star"></span>
                                                <span class="star"></span>
                                                <span class="star"></span>
                                                <span class="star"></span>
                                            </div>
                                        }
                                        else if (item.score == 2)
                                        {
                                            score2++;
                                            <div aria-hidden="true">
                                                <span class="star star--full"></span>
                                                <span class="star star--full"></span>
                                                <span class="star"></span>
                                                <span class="star"></span>
                                                <span class="star"></span>
                                            </div>
                                        }
                                        else if (item.score == 3)
                                        {
                                            score3++;
                                            <div aria-hidden="true">
                                                <span class="star star--full"></span>
                                                <span class="star star--full"></span>
                                                <span class="star star--full"></span>
                                                <span class="star"></span>
                                                <span class="star"></span>
                                            </div>
                                        }
                                        else if (item.score == 4)
                                        {
                                            score4++;
                                            <div aria-hidden="true">
                                                <span class="star star--full"></span>
                                                <span class="star star--full"></span>
                                                <span class="star star--full"></span>
                                                <span class="star star--full"></span>
                                                <span class="star star--full"></span>
                                            </div>
                                        }
                                        else if (item.score == 5)
                                        {
                                            score5++;
                                            <div aria-hidden="true">
                                                <span class="star star--full"></span>
                                                <span class="star star--full"></span>
                                                <span class="star star--full"></span>
                                                <span class="star star--full"></span>
                                                <span class="star star--full"></span>
                                            </div>
                                        }
                                    </div>
                                    <hr />
                                </div>
                            }
                        }
                        <div class="rating-box">
                            <div class="score-container">
                                <div class="score"></div>
                                <div class="score-container-star-rating">
                                    <div class="current-rating"></div>
                                </div>
                                <div class="reviews-stats"><span class="reviewers-small">Lượt đánh giá:</span><span class="reviews-num"></span></div>
                            </div>
                            <div class="rating-histogram">
                                <div class="rating-bar-container five" valuenow="@score5"><span class="bar-label">5</span><span class="bar"></span><span class="bar-number"></span></div>
                                <div class="rating-bar-container four" valuenow="@score4"><span class="bar-label">4</span><span class="bar"></span><span class="bar-number"></span></div>
                                <div class="rating-bar-container three" valuenow="@score3"><span class="bar-label">3</span><span class="bar"></span><span class="bar-number"></span></div>
                                <div class="rating-bar-container two" valuenow="@score2"><span class="bar-label">2</span><span class="bar"></span><span class="bar-number"></span></div>
                                <div class="rating-bar-container one" valuenow="@score1"><span class="bar-label">1</span><span class="bar"></span><span class="bar-number"></span></div>
                            </div>
                        </div>
                        <div class="text-right">
                            @if (flag)
                            {
                                <a class="btn margin-top-20 margin-right-20" onclick="showInPopup('@Url.Action("Rating", "Product",new { product_id = Model.Product.id }, Context.Request.Scheme)','Đánh giá sản phẩm')">Viết đánh giá</a>
                            }
                            else
                            {
                                <a class="btn margin-top-20 margin-right-20" onclick="alert('Quý khách đã đánh giá này rồi, không thể đánh giá lại.')">Viết đánh giá</a>
                            }
                        </div>
                    </div>
                </div>
                <h4 class="margin-top-20">
                    Bình luận sản phẩm
                </h4>
                <div class="comments-facebook">
                    <div class="fb-comments" data-href="https://techshop.io/san-pham/@Model.Product.slug" data-width="100%" data-numposts="5"></div>
                </div>
            </div>
        </div>
    </div>
    <h3 class=" margin-top-20">Cùng thương hiệu  @Model.Product.brand_name</h3>
    <ul class="thumbnails">
        @{
            if (Model.ProductsRelated != null)
            {
                foreach (var product in Model.ProductsRelated)
                {
                    <li class="span3">
                        <div class="thumbnail">
                            @{ TimeSpan days = DateTime.Now.Subtract(product.create_at); }
                            @if (product.featured)
                            {
                                <i class="tag-featured"></i>
                            }
                            else if (product.best_seller)
                            {
                                <i class="tag-best-seller"></i>
                            }
                            else if (product.promotion_price > 1)
                            {
                                <i class="tag-sale"></i>
                            }
                            else if (days.TotalDays == 7)
                            {
                                <i class="tag"></i>
                            }
                            <a href="@Url.Action("Detail", "Product", new { slug = product.slug })"><img src="data:image/jpeg;base64,@product.image" alt="@product.name" /></a>
                            <div class="caption">
                                <h5>@product.name</h5>
                            </div>
                            <div class="footer-thumbnail">
                                @if (product.promotion_price > 1)
                                {
                                    <span class="product-price">@String.Format(info, "{0:c}", product.promotion_price)</span><br />
                                    <span class="product-promotion-pirce">@String.Format(info, "{0:c}", product.unit_price)</span>
                                }
                                else
                                {
                                    <span class="product-price">@String.Format(info, "{0:c}", product.unit_price)</span>
                                }
                            </div>
                            <h4 style="text-align:center">
                                <a class="btn" href="@Url.Action("Detail", "Product", new { slug = product.slug })">Xem Chi tiết</a>
                            </h4>
                        </div>
                    </li>
                }
            }
        }
    </ul>
}
